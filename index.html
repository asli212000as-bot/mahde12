<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ูุชุฌุฑ ุงููุฑุฏ ุงููุงุฎุฑ</title>
<link rel="stylesheet" href="styles.css">
</head>
<body>

<header>
  <div class="header-title">๐ธ ูุชุฌุฑ ุงููุฑุฏ ุงููุงุฎุฑ</div>
</header>

<div class="container">

  <div class="flex" style="justify-content:center;gap:12px;margin:20px 0">
    <button class="btn section-btn" data-target="ready-section">๐ ุงูุจุงูุงุช ุงููุชููุฑุฉ</button>
    <button class="btn section-btn" data-target="cs-section">๐ ุฎุฏูุฉ ุงูุนููุงุก</button>
  </div>

  <!-- ุงูุจุงูุงุช ุงูุฌุงูุฒุฉ -->
  <div id="ready-section" class="section">
    <h2>ุงูุจุงูุงุช ุงูุฌุงูุฒุฉ</h2>
    <div id="ready-bouquets" class="grid"></div>
  </div>

  <!-- ุฎุฏูุฉ ุงูุนููุงุก -->
  <div id="cs-section" class="section" style="display:none">
    <h2>ุฎุฏูุฉ ุงูุนููุงุก</h2>
    <form id="csForm" class="card cs-form">
      <div class="form-row"><label>ุงุณูู</label><input type="text" id="csName" required></div>
      <div class="form-row"><label>ุงุณุชูุณุงุฑู</label><textarea id="csMsg" required></textarea></div>
      <div style="text-align:left;margin-top:10px"><button class="btn" type="submit">ุฅุฑุณุงู</button></div>
    </form>
  </div>

  <!-- ููุฏุงู ุชูุงุตูู ุงูุจุงูุฉ -->
  <div id="bqModal" class="modal" style="display:none">
    <div class="modal-content card">
      <span class="close-btn">&times;</span>
      <div id="modalImgContainer" style="width:200px;height:200px;margin:0 auto;overflow:hidden;border-radius:12px">
        <img id="modalImg" src="" style="width:100%;height:100%;object-fit:cover;">
      </div>
      <h3 id="modalName" style="text-align:center;margin-top:8px"></h3>
      <p id="modalDesc" class="small" style="text-align:center"></p>

      <div class="form-row"><label>ุนุฏุฏ ุงููุฑูุฏ</label><input type="number" id="modalQty" min="1" value="10"></div>
      <div class="form-row"><label>ููู ุงููุฑุฏ</label><select id="modalColorSelect"></select></div>
      <div class="form-row"><label>ููุน ุงูุชุบููู</label><select id="modalPackSelect"></select></div>
      <div class="form-row"><label>ุงุณู ุงููุฑุณู</label><input type="text" id="modalNameInput"></div>
      <div class="form-row"><label>ุฑูู ุงููุงุชู</label><input type="text" id="modalPhoneInput"></div>

      <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
        <button class="btn" id="modalSendBtn">ุฅุฑุณุงู ุงูุทูุจ</button>
      </div>

      <div class="card" style="margin-top:12px">
        <div class="small">ุณุนุฑ ุงููุฑุฏุฉ: <span id="modalFlowerPrice"></span> ุฏ.ุน</div>
        <div class="small">ุณุนุฑ ุงูุชุบููู: <span id="modalPackPrice"></span> ุฏ.ุน</div>
        <div style="margin-top:8px;font-weight:700;color:var(--accent)">ุงููุฌููุน: <span id="modalTotalPrice">0</span> ุฏ.ุน</div>
      </div>
    </div>
  </div>

  <div class="footer">ยฉ 2025 ูุชุฌุฑ ุงููุฑุฏ โ ุฌููุน ุงูุญููู ูุญููุธุฉ</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "YOUR_API_KEY",
  authDomain: "PROJECT_ID.firebaseapp.com",
  projectId: "PROJECT_ID",
  storageBucket: "PROJECT_ID.appspot.com",
  messagingSenderId: "SENDER_ID",
  appId: "APP_ID"
};
const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

// ุงูุฃูุณุงู
document.querySelectorAll('.section-btn').forEach(btn=>{
  btn.addEventListener('click', ()=>{
    document.querySelectorAll('.section').forEach(sec=>sec.style.display='none');
    document.getElementById(btn.dataset.target).style.display='block';
  });
});

let bouquets=[], settings={flowerPrice:50,packs:[],colors:[]};
const readyBouquetsEl=document.getElementById('ready-bouquets');

// ุฌูุจ ุงูุจุงูุงุช
db.collection('bouquets').get().then(snapshot=>{
  bouquets=[];
  snapshot.forEach(doc=>bouquets.push({...doc.data(),id:doc.id}));
  renderReadyBouquets();
});

// ุฌูุจ ุงูุฅุนุฏุงุฏุงุช
db.collection('settings').doc('main').get().then(doc=>{
  if(doc.exists){settings=doc.data();}
});

// ุงูููุฏุงู
const bqModal=document.getElementById('bqModal');
const modalImg=document.getElementById('modalImg');
const modalName=document.getElementById('modalName');
const modalDesc=document.getElementById('modalDesc');
const modalQty=document.getElementById('modalQty');
const modalColorSelect=document.getElementById('modalColorSelect');
const modalPackSelect=document.getElementById('modalPackSelect');
const modalNameInput=document.getElementById('modalNameInput');
const modalPhoneInput=document.getElementById('modalPhoneInput');
const modalSendBtn=document.getElementById('modalSendBtn');
const modalFlowerPrice=document.getElementById('modalFlowerPrice');
const modalPackPrice=document.getElementById('modalPackPrice');
const modalTotalPrice=document.getElementById('modalTotalPrice');
const modalClose=document.querySelector('.close-btn');

modalClose.onclick=()=>{bqModal.style.display='none';};

function openModal(bq){
  modalImg.src=bq.image;
  modalName.textContent=bq.name;
  modalDesc.textContent=bq.description||'';
  modalQty.value=10;
  modalNameInput.value=''; modalPhoneInput.value='';
  modalColorSelect.innerHTML=''; (settings.colors||[]).forEach(c=> modalColorSelect.innerHTML+=`<option value="${c}">${c}</option>`);
  modalPackSelect.innerHTML=''; (settings.packs||[]).forEach((p,idx)=> modalPackSelect.innerHTML+=`<option value="${idx}">${p.name} (+${p.price} ุฏ.ุน)</option>`);
  
  function updateModalPrice(){
    const qty=Number(modalQty.value)||0;
    const flower=settings.flowerPrice||0;
    const packIdx=Number(modalPackSelect.value);
    const pack=settings.packs[packIdx]||{price:0};
    const total=Math.round(qty*flower+pack.price);
    modalFlowerPrice.textContent=flower;
    modalPackPrice.textContent=pack.price;
    modalTotalPrice.textContent=total;
  }

  modalQty.addEventListener('input',updateModalPrice);
  modalPackSelect.addEventListener('change',updateModalPrice);
  updateModalPrice();
  bqModal.style.display='flex';

  modalSendBtn.onclick=()=>{
    const qty=Number(modalQty.value)||0;
    const name=modalNameInput.value.trim();
    const phone=modalPhoneInput.value.trim();
    if(!name||!phone) return alert('ุฃุฏุฎู ุงูุงุณู ูุฑูู ุงููุงุชู');
    const packIdx=Number(modalPackSelect.value);
    const pack=settings.packs[packIdx]||{name:'',price:0};
    const total=Math.round(qty*(settings.flowerPrice||0)+pack.price);
    const order={pkgName:bq.name,qty,color:modalColorSelect.value,pack:pack.name,price:total,name,phone,status:'new',created:Date.now()};
    db.collection('orders').add(order).then(()=>{alert('ุชู ุฅุฑุณุงู ุงูุทูุจ. ุงููุฌููุน: '+total+' ุฏ.ุน');bqModal.style.display='none';});
  };
}

function renderReadyBouquets(){
  readyBouquetsEl.innerHTML='';
  if(!bouquets.length){ readyBouquetsEl.innerHTML='<div class="small">ูุง ุชูุฌุฏ ุจุงูุงุช ุญุงููุงู</div>'; return; }
  bouquets.forEach(b=>{
    const d=document.createElement('div');
    d.className='bouquet-card card';
    d.innerHTML = `
      <div style="width:150px;height:150px;overflow:hidden;margin:0 auto;border-radius:12px;cursor:pointer">
        <img src="${b.image}" alt="${b.name}" style="width:100%;height:100%;object-fit:cover;">
      </div>
      <h3 style="text-align:center;margin-top:8px">${b.name}</h3>
      <p class="small" style="text-align:center">${b.description||''}</p>
      <div class="price" style="text-align:center">${b.price} ุฏ.ุน</div>
    `;
    readyBouquetsEl.appendChild(d);
    d.querySelector('div').onclick=()=>openModal(b);
  });
}

// ุฎุฏูุฉ ุงูุนููุงุก
document.getElementById('csForm').addEventListener('submit',e=>{
  e.preventDefault();
  const n=document.getElementById('csName').value.trim();
  const m=document.getElementById('csMsg').value.trim();
  if(!n||!m) return alert('ุงููุฃ ุงูุญููู');
  db.collection('cs').add({name:n,msg:m,time:Date.now()}).then(()=>{
    alert('ุชู ุฅุฑุณุงู ุงูุฑุณุงูุฉ.');
    e.target.reset();
  });
});
</script>
</body>
</html>

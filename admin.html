<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…ØªØ¬Ø±</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="header-title">ğŸ”§ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… - Ù…ØªØ¬Ø± Ø§Ù„ÙˆØ±Ø¯</div>
    <div class="small">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§ØªØŒ Ø§Ù„Ø£Ø³Ø¹Ø§Ø±ØŒ ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª</div>
  </header>

  <div class="container">
    <!-- Ø­Ù…Ø§ÙŠØ© Ø¨Ø³ÙŠØ·Ø© -->
    <div class="card">
      <h3>ØªØ³Ø¬ÙŠÙ„ Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø£Ø¯Ù…Ù†</h3>
      <div class="form-row">
        <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
        <input type="password" id="adminPass" placeholder="Ø§Ø¯Ø®Ù„ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±">
        <button class="btn" id="adminLogin">Ø¯Ø®ÙˆÙ„</button>
      </div>
      <div id="adminLockedMsg" class="small">Ù…Ø¹Ø·Ù„: ÙŠØ±Ø¬Ù‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ù„Ø¹Ø±Ø¶ Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ….</div>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… (Ù…Ø®ÙÙŠØ© Ø­ØªÙ‰ ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„) -->
    <div id="adminPanel" style="display:none">
      <div class="card admin-columns">
        <div>
          <h3>Ø¥Ø¶Ø§ÙØ© / ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø§Ù‚Ø©</h3>
          <div class="form-row"><label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ù‚Ø©</label><input type="text" id="bqName"></div>
          <div class="form-row"><label>Ø§Ù„ÙˆØµÙ</label><input type="text" id="bqDesc"></div>
          <div class="form-row"><label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ (Ø¹Ø±Ø¶)</label><input type="number" id="bqPrice" value="0"></div>
          <div class="form-row"><label>ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ù‚Ø©</label><input type="file" id="bqImage" accept="image/*"></div>
          <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
            <button class="btn" id="saveBq">Ø­ÙØ¸ Ø§Ù„Ø¨Ø§Ù‚Ø©</button>
            <button class="btn ghost" id="clearBq">Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
          </div>

          <h3 style="margin-top:14px">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¹Ø§Ù…Ø©</h3>
          <div class="form-row"><label>Ø³Ø¹Ø± Ø§Ù„ÙˆØ±Ø¯Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©</label><input type="number" id="flowerPrice" value="50"></div>
          <div class="form-row"><label>Ø£Ù„ÙˆØ§Ù† Ù…ØªØ§Ø­Ø© (Ù…ÙØµÙˆÙ„Ø© Ø¨ÙÙˆØ§ØµÙ„)</label><input type="text" id="colorsInput" placeholder="Ø£Ø­Ù…Ø±,Ø£Ø¨ÙŠØ¶,ÙˆØ±Ø¯ÙŠ"></div>

          <h4>Ø£Ø³Ø¹Ø§Ø± Ø§Ù„ØªØºÙ„ÙŠÙ</h4>
          <div id="packsContainer"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input type="text" id="newPackName" placeholder="Ø§Ø³Ù… Ø§Ù„ØªØºÙ„ÙŠÙ">
            <input type="number" id="newPackPrice" placeholder="Ø³Ø¹Ø±">
            <button class="btn" id="addPack">Ø¥Ø¶Ø§ÙØ© ØªØºÙ„ÙŠÙ</button>
          </div>

          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
            <button class="btn" id="saveSettings">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
          </div>
        </div>

        <div>
          <h3>Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª</h3>
          <div id="adminBouquets" style="max-height:300px;overflow:auto"></div>

          <h3 style="margin-top:12px">Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„ÙˆØ§Ø±Ø¯Ø©</h3>
          <div style="display:flex;gap:8px;margin-bottom:8px">
            <button class="btn small" onclick="filterOrders('all')">Ø§Ù„ÙƒÙ„</button>
            <button class="btn small" onclick="filterOrders('new')">Ø¬Ø¯ÙŠØ¯Ø©</button>
            <button class="btn small" onclick="filterOrders('ready')">Ø¬Ø§Ù‡Ø²Ø©</button>
            <button class="btn small" onclick="filterOrders('completed')">Ù…ÙƒØªÙ…Ù„Ø©</button>
          </div>
          <div id="ordersList" class="orders-list" style="max-height:420px;overflow:auto"></div>
        </div>
      </div>

      <div class="card">
        <h3>Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ (Ø§Ù„Ø±Ø³Ø§Ø¦Ù„)</h3>
        <div id="csList" class="cs-list"></div>
      </div>
    </div>

    <div class="footer">Â© 2025 Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ù…ØªØ¬Ø± Ø§Ù„ÙˆØ±Ø¯</div>
  </div>

<script>
/* ==== Ù…ÙØ§ØªÙŠØ­ Ø§Ù„ØªØ®Ø²ÙŠÙ†: bouquets, settings, orders, cs ==== */
const ADMIN_PASSWORD = 'admin123'; // Ø¹Ø¯Ù„Ù‡Ø§ Ø£Ùˆ Ø§Ø±Ø¨Ø· Firebase Auth Ù„Ø§Ø­Ù‚Ù‹Ø§

function getState(key, fallback){ try{return JSON.parse(localStorage.getItem(key))||fallback;}catch(e){return fallback;} }
function setState(key,val){ localStorage.setItem(key, JSON.stringify(val)); }

// Ø¹Ù†Ø§ØµØ±
const adminLogin = document.getElementById('adminLogin');
const adminPass = document.getElementById('adminPass');
const adminPanel = document.getElementById('adminPanel');
const adminLockedMsg = document.getElementById('adminLockedMsg');

const bqName = document.getElementById('bqName'), bqDesc = document.getElementById('bqDesc'), bqPrice = document.getElementById('bqPrice'), bqImage = document.getElementById('bqImage');
const saveBq = document.getElementById('saveBq'), clearBq = document.getElementById('clearBq');
const adminBouquets = document.getElementById('adminBouquets');

const flowerPriceIn = document.getElementById('flowerPrice'), colorsInput = document.getElementById('colorsInput');
const packsContainer = document.getElementById('packsContainer'), addPack = document.getElementById('addPack'), newPackName = document.getElementById('newPackName'), newPackPrice = document.getElementById('newPackPrice');
const saveSettings = document.getElementById('saveSettings');
const ordersList = document.getElementById('ordersList');
const csList = document.getElementById('csList');

let bouquets = getState('bouquets', []);
let settings = getState('settings', {flowerPrice:50, packs:[{name:'ØµÙ†Ø¯ÙˆÙ‚',price:10},{name:'Ø³Ù„Ø©',price:7}], colors:['Ø£Ø­Ù…Ø±','Ø£Ø¨ÙŠØ¶','ÙˆØ±Ø¯ÙŠ']});
let orders = getState('orders', []);
let cs = getState('cs', []);

function lockToAdmin(){
  adminPanel.style.display='none'; adminLockedMsg.style.display='block';
}
function unlockAdmin(){
  adminPanel.style.display='block'; adminLockedMsg.style.display='none';
  populateAdmin();
}

adminLogin.addEventListener('click', ()=>{
  if(adminPass.value === ADMIN_PASSWORD){
    unlockAdmin();
    adminPass.value='';
  } else alert('ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± Ø®Ø§Ø·Ø¦Ø©');
});

// Ø­ÙØ¸ Ø¨Ø§Ù‚Ø© (Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø© Ø¥Ù„Ù‰ Base64)
saveBq.addEventListener('click', ()=>{
  const name = bqName.value.trim(); if(!name) return alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ù‚Ø©');
  const price = Number(bqPrice.value)||0;
  const desc = bqDesc.value.trim();
  const file = bqImage.files[0];
  if(file){
    const r = new FileReader();
    r.onload = e=>{
      bouquets.unshift({name,description:desc,price,image:e.target.result});
      setState('bouquets', bouquets);
      alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø©');
      clearBqFields();
      populateAdmin();
    };
    r.readAsDataURL(file);
  } else {
    bouquets.unshift({name,description:desc,price,image:'',});
    setState('bouquets', bouquets);
    alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø© (Ø¨Ø¯ÙˆÙ† ØµÙˆØ±Ø©)');
    clearBqFields();
    populateAdmin();
  }
});

clearBq.addEventListener('click', clearBqFields);
function clearBqFields(){ bqName.value=''; bqDesc.value=''; bqPrice.value='0'; bqImage.value=''; }

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª ÙÙŠ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
function populateAdmin(){
  // Ø¨Ø§Ù‚Ø§Øª
  adminBouquets.innerHTML='';
  bouquets.forEach((b,i)=>{
    const div = document.createElement('div');
    div.className='bouquet-card';
    div.innerHTML = `
      <div style="display:flex;gap:8px;align-items:center">
        <img src="${b.image||'data:image/svg+xml;utf8,<svg xmlns=...></svg>'}" style="width:64px;height:64px;object-fit:cover;border-radius:8px">
        <div style="flex:1">
          <strong>${b.name}</strong>
          <div class="small">${b.price} Ø¯.Ø¹</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px">
          <button class="btn small" onclick="editBq(${i})">ØªØ¹Ø¯ÙŠÙ„</button>
          <button class="btn ghost small" onclick="deleteBq(${i})">Ø­Ø°Ù</button>
        </div>
      </div>
    `;
    adminBouquets.appendChild(div);
  });

  // Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
  flowerPriceIn.value = settings.flowerPrice || 0;
  colorsInput.value = (settings.colors||[]).join(',');
  renderPacks();

  // Ø§Ù„Ø·Ù„Ø¨Ø§Øª
  renderOrders();

  // Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
  renderCS();
}

function editBq(i){
  const b = bouquets[i];
  bqName.value = b.name;
  bqDesc.value = b.description||'';
  bqPrice.value = b.price||0;
  // Ù„Ù„ØªØ¹Ø¯ÙŠÙ„: Ù†Ù‚ÙˆÙ… Ø¨Ø­Ø°Ù Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ø«Ù… Ø­ÙØ¸ Ø§Ù„Ø¬Ø¯ÙŠØ¯Ø© Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø­ÙØ¸
  // Ø£Ùˆ ÙŠÙ…ÙƒÙ† Ø¹Ù…Ù„ Ù†Ø¸Ø§Ù… id Ù„Ù„ØªØ¹Ø¯ÙŠÙ„ Ù„Ø§Ø­Ù‚Ù‹Ø§ â€” Ù‡Ø°Ù‡ Ù†Ø³Ø®Ø© Ù…Ø¨Ø³Ø·Ø©
  bouquets.splice(i,1);
  setState('bouquets', bouquets);
  populateAdmin();
}

function deleteBq(i){
  if(!confirm('Ø­Ø°Ù Ø§Ù„Ø¨Ø§Ù‚Ø©ØŸ')) return;
  bouquets.splice(i,1); setState('bouquets', bouquets); populateAdmin();
}

// Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØºÙ„ÙŠÙ
function renderPacks(){
  packsContainer.innerHTML='';
  (settings.packs||[]).forEach((p,idx)=>{
    const div = document.createElement('div');
    div.className='form-row';
    div.innerHTML = `<label>${p.name}</label><input type="number" value="${p.price}" data-idx="${idx}" class="pack-input"> <button class="btn ghost small" onclick="removePack(${idx})">Ø­Ø°Ù</button>`;
    packsContainer.appendChild(div);
  });
  // Ø£Ø¶Ù Ù…Ø³ØªÙ…Ø¹ Ù„ØªØºÙŠÙ‘Ø± Ø§Ù„Ø£Ø³Ø¹Ø§Ø±
  Array.from(document.getElementsByClassName('pack-input')).forEach(inp=>{
    inp.addEventListener('input', e=>{
      const idx = e.target.getAttribute('data-idx');
      settings.packs[idx].price = Number(e.target.value) || 0;
    });
  });
}

addPack.addEventListener('click', ()=>{
  const name = newPackName.value.trim(); const price = Number(newPackPrice.value)||0;
  if(!name) return alert('Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„ØªØºÙ„ÙŠÙ');
  settings.packs.push({name,price});
  newPackName.value=''; newPackPrice.value='';
  renderPacks();
});

// Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
saveSettings.addEventListener('click', ()=>{
  settings.flowerPrice = Number(flowerPriceIn.value) || 0;
  settings.colors = colorsInput.value.split(',').map(s=>s.trim()).filter(Boolean);
  setState('settings', settings);
  alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª');
  // ØªØ­Ø¯ÙŠØ« Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ø¹Ø§Ù…Ø©
  // (index.html) Ø³ÙŠÙ‚Ø±Ø£ Ù…Ù† localStorage ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØªØ§Ù„ÙŠ
});

// Ø·Ù„Ø¨Ø§Øª ÙˆØ¥Ø¯Ø§Ø±ØªÙ‡Ø§
function renderOrders(filter='all'){
  orders = getState('orders', []);
  ordersList.innerHTML='';
  const filtered = orders.filter(o=> filter==='all' ? true : o.status===filter );
  if(!filtered.length){ ordersList.innerHTML = '<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</div>'; return; }
  filtered.forEach((o,i)=>{
    const idx = orders.indexOf(o); // index in main orders array
    const div = document.createElement('div');
    div.className='order-item';
    div.innerHTML = `
      <div style="flex:1">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>Ø·Ù„Ø¨ #${idx+1} â€” ${o.pkgName}</strong>
          <span class="tag ${o.status}">${o.status==='new'?'Ø¬Ø¯ÙŠØ¯Ø©':o.status==='ready'?'Ø¬Ø§Ù‡Ø²Ø©':'Ù…ÙƒØªÙ…Ù„Ø©'}</span>
        </div>
        <div class="order-meta">
          ${o.qty} ÙˆØ±Ø¯Ø© â€” Ù„ÙˆÙ†: ${o.color} â€” ØªØºÙ„ÙŠÙ: ${o.pack} â€” Ø§Ù„Ø³Ø¹Ø±: ${o.price} Ø¯.Ø¹
          <div>Ø§Ù„Ø§Ø³Ù…: ${o.name} â€” Ø§Ù„Ù‡Ø§ØªÙ: ${o.phone}</div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px">
        ${ o.status === 'new' ? `<button class="btn small" onclick="markReady(${idx})">ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨</button>` : '' }
        ${ o.status === 'ready' ? `<button class="btn small" onclick="markCompleted(${idx})">ØªÙ… Ø§Ù„ØªØ³Ù„ÙŠÙ…</button>` : '' }
        <button class="btn ghost small" onclick="deleteOrder(${idx})">Ø­Ø°Ù</button>
      </div>
    `;
    ordersList.appendChild(div);
  });
}

function markReady(i){
  orders[i].status = 'ready'; setState('orders', orders); renderOrders(currentFilter);
}
function markCompleted(i){
  orders[i].status = 'completed'; setState('orders', orders); renderOrders(currentFilter);
}
function deleteOrder(i){
  if(!confirm('Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨ØŸ')) return;
  orders.splice(i,1); setState('orders', orders); renderOrders(currentFilter);
}

let currentFilter = 'all';
function filterOrders(f){ currentFilter = f; renderOrders(f); }

// Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
function renderCS(){
  cs = getState('cs', []);
  csList.innerHTML='';
  if(!cs.length) { csList.innerHTML = '<div class="small">Ù„Ø§ Ø±Ø³Ø§Ø¦Ù„</div>'; return; }
  cs.forEach((m, i)=>{
    const d = document.createElement('div');
    d.className='cs-item';
    d.innerHTML = `<div><strong>${m.name}</strong> <span class="small">(${new Date(m.time).toLocaleString()})</span></div><div>${m.msg}</div><div style="text-align:left;margin-top:6px"><button class="btn ghost small" onclick="deleteCS(${i})">Ø­Ø°Ù</button></div>`;
    csList.appendChild(d);
  });
}
function deleteCS(i){ cs.splice(i,1); setState('cs', cs); renderCS(); }

// init
lockToAdmin();
// make sure stored settings are present
setState('settings', settings);
setState('bouquets', bouquets);
setState('orders', orders);
setState('cs', cs);
</script>
</body>
</html>


<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ููุญุฉ ุชุญูู ุงููุชุฌุฑ</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="header-title">๐ง ููุญุฉ ุชุญูู - ูุชุฌุฑ ุงููุฑุฏ</div>
    <div class="small">ุฅุฏุงุฑุฉ ุงูุจุงูุงุชุ ุงูุฃุณุนุงุฑุ ูุงูุทูุจุงุช</div>
  </header>

  <div class="container">
    <!-- ุญูุงูุฉ ุจุณูุทุฉ -->
    <div class="card">
      <h3>ุชุณุฌูู ุฏุฎูู ุงูุฃุฏูู</h3>
      <div class="form-row">
        <label>ูููุฉ ุงููุฑูุฑ</label>
        <input type="password" id="adminPass" placeholder="ุงุฏุฎู ูููุฉ ุงููุฑูุฑ">
        <button class="btn" id="adminLogin">ุฏุฎูู</button>
      </div>
      <div id="adminLockedMsg" class="small">ูุนุทู: ูุฑุฌู ุชุณุฌูู ุงูุฏุฎูู ูุนุฑุถ ููุญุฉ ุงูุชุญูู.</div>
    </div>

    <!-- ููุญุฉ ุงูุชุญูู (ูุฎููุฉ ุญุชู ุชุณุฌูู ุงูุฏุฎูู) -->
    <div id="adminPanel" style="display:none">
      <div class="card admin-columns">
        <div>
          <h3>ุฅุถุงูุฉ / ุชุนุฏูู ุจุงูุฉ</h3>
          <div class="form-row"><label>ุงุณู ุงูุจุงูุฉ</label><input type="text" id="bqName"></div>
          <div class="form-row"><label>ุงููุตู</label><input type="text" id="bqDesc"></div>
          <div class="form-row"><label>ุงูุณุนุฑ ุงูุฃุณุงุณู (ุนุฑุถ)</label><input type="number" id="bqPrice" value="0"></div>
          <div class="form-row"><label>ุตูุฑุฉ ุงูุจุงูุฉ</label><input type="file" id="bqImage" accept="image/*"></div>
          <div style="display:flex;justify-content:flex-end;gap:8px;margin-top:8px">
            <button class="btn" id="saveBq">ุญูุธ ุงูุจุงูุฉ</button>
            <button class="btn ghost" id="clearBq">ูุณุญ ุงูุญููู</button>
          </div>

          <h3 style="margin-top:14px">ุฅุนุฏุงุฏุงุช ุนุงูุฉ</h3>
          <div class="form-row"><label>ุณุนุฑ ุงููุฑุฏุฉ ุงููุงุญุฏุฉ</label><input type="number" id="flowerPrice" value="50"></div>
          <div class="form-row"><label>ุฃููุงู ูุชุงุญุฉ (ููุตููุฉ ุจููุงุตู)</label><input type="text" id="colorsInput" placeholder="ุฃุญูุฑ,ุฃุจูุถ,ูุฑุฏู"></div>

          <h4>ุฃุณุนุงุฑ ุงูุชุบููู</h4>
          <div id="packsContainer"></div>
          <div style="display:flex;gap:8px;margin-top:8px">
            <input type="text" id="newPackName" placeholder="ุงุณู ุงูุชุบููู">
            <input type="number" id="newPackPrice" placeholder="ุณุนุฑ">
            <button class="btn" id="addPack">ุฅุถุงูุฉ ุชุบููู</button>
          </div>

          <div style="display:flex;gap:8px;justify-content:flex-end;margin-top:10px">
            <button class="btn" id="saveSettings">ุญูุธ ุงูุฅุนุฏุงุฏุงุช</button>
          </div>
        </div>

        <div>
          <h3>ูุงุฆูุฉ ุงูุจุงูุงุช</h3>
          <div id="adminBouquets" style="max-height:300px;overflow:auto"></div>

          <h3 style="margin-top:12px">ุงูุทูุจุงุช ุงููุงุฑุฏุฉ</h3>
          <div style="display:flex;gap:8px;margin-bottom:8px">
            <button class="btn small" onclick="filterOrders('all')">ุงููู</button>
            <button class="btn small" onclick="filterOrders('new')">ุฌุฏูุฏุฉ</button>
            <button class="btn small" onclick="filterOrders('ready')">ุฌุงูุฒุฉ</button>
            <button class="btn small" onclick="filterOrders('completed')">ููุชููุฉ</button>
          </div>
          <div id="ordersList" class="orders-list" style="max-height:420px;overflow:auto"></div>
        </div>
      </div>

      <div class="card">
        <h3>ุฎุฏูุฉ ุงูุนููุงุก (ุงูุฑุณุงุฆู)</h3>
        <div id="csList" class="cs-list"></div>
      </div>
    </div>

    <div class="footer">ยฉ 2025 ููุญุฉ ุชุญูู ูุชุฌุฑ ุงููุฑุฏ</div>
  </div>

<script>
/* ==== ููุงุชูุญ ุงูุชุฎุฒูู: bouquets, settings, orders, cs ==== */
const ADMIN_PASSWORD = 'admin123'; // ุนุฏููุง ุฃู ุงุฑุจุท Firebase Auth ูุงุญููุง

function getState(key, fallback){ try{return JSON.parse(localStorage.getItem(key))||fallback;}catch(e){return fallback;} }
function setState(key,val){ localStorage.setItem(key, JSON.stringify(val)); }

// ุนูุงุตุฑ
const adminLogin = document.getElementById('adminLogin');
const adminPass = document.getElementById('adminPass');
const adminPanel = document.getElementById('adminPanel');
const adminLockedMsg = document.getElementById('adminLockedMsg');

const bqName = document.getElementById('bqName'), bqDesc = document.getElementById('bqDesc'), bqPrice = document.getElementById('bqPrice'), bqImage = document.getElementById('bqImage');
const saveBq = document.getElementById('saveBq'), clearBq = document.getElementById('clearBq');
const adminBouquets = document.getElementById('adminBouquets');

const flowerPriceIn = document.getElementById('flowerPrice'), colorsInput = document.getElementById('colorsInput');
const packsContainer = document.getElementById('packsContainer'), addPack = document.getElementById('addPack'), newPackName = document.getElementById('newPackName'), newPackPrice = document.getElementById('newPackPrice');
const saveSettings = document.getElementById('saveSettings');
const ordersList = document.getElementById('ordersList');
const csList = document.getElementById('csList');

let bouquets = getState('bouquets', []);
let settings = getState('settings', {flowerPrice:50, packs:[{name:'ุตูุฏูู',price:10},{name:'ุณูุฉ',price:7}], colors:['ุฃุญูุฑ','ุฃุจูุถ','ูุฑุฏู']});
let orders = getState('orders', []);
let cs = getState('cs', []);

function lockToAdmin(){
  adminPanel.style.display='none'; adminLockedMsg.style.display='block';
}
function unlockAdmin(){
  adminPanel.style.display='block'; adminLockedMsg.style.display='none';
  populateAdmin();
}

adminLogin.addEventListener('click', ()=>{
  if(adminPass.value === ADMIN_PASSWORD){
    unlockAdmin();
    adminPass.value='';
  } else alert('ูููุฉ ุงููุฑูุฑ ุฎุงุทุฆุฉ');
});

// ุญูุธ ุจุงูุฉ (ุฑูุน ุงูุตูุฑุฉ ุฅูู Base64)
saveBq.addEventListener('click', ()=>{
  const name = bqName.value.trim(); if(!name) return alert('ุงูุชุจ ุงุณู ุงูุจุงูุฉ');
  const price = Number(bqPrice.value)||0;
  const desc = bqDesc.value.trim();
  const file = bqImage.files[0];
  if(file){
    const r = new FileReader();
    r.onload = e=>{
      bouquets.unshift({name,description:desc,price,image:e.target.result});
      setState('bouquets', bouquets);
      alert('ุชูุช ุฅุถุงูุฉ ุงูุจุงูุฉ');
      clearBqFields();
      populateAdmin();
    };
    r.readAsDataURL(file);
  } else {
    bouquets.unshift({name,description:desc,price,image:'',});
    setState('bouquets', bouquets);
    alert('ุชูุช ุฅุถุงูุฉ ุงูุจุงูุฉ (ุจุฏูู ุตูุฑุฉ)');
    clearBqFields();
    populateAdmin();
  }
});

clearBq.addEventListener('click', clearBqFields);
function clearBqFields(){ bqName.value=''; bqDesc.value=''; bqPrice.value='0'; bqImage.value=''; }

// ุฅุฏุงุฑุฉ ุงูุจุงูุงุช ูู ุงููุงุฌูุฉ
function populateAdmin(){
  // ุจุงูุงุช
  adminBouquets.innerHTML='';
  bouquets.forEach((b,i)=>{
    const div = document.createElement('div');
    div.className='bouquet-card';
    div.innerHTML = `
      <div style="display:flex;gap:8px;align-items:center">
        <img src="${b.image||'data:image/svg+xml;utf8,<svg xmlns=...></svg>'}" style="width:64px;height:64px;object-fit:cover;border-radius:8px">
        <div style="flex:1">
          <strong>${b.name}</strong>
          <div class="small">${b.price} ุฏ.ุน</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:6px">
          <button class="btn small" onclick="editBq(${i})">ุชุนุฏูู</button>
          <button class="btn ghost small" onclick="deleteBq(${i})">ุญุฐู</button>
        </div>
      </div>
    `;
    adminBouquets.appendChild(div);
  });

  // ุฅุนุฏุงุฏุงุช
  flowerPriceIn.value = settings.flowerPrice || 0;
  colorsInput.value = (settings.colors||[]).join(',');
  renderPacks();

  // ุงูุทูุจุงุช
  renderOrders();

  // ุฎุฏูุฉ ุงูุนููุงุก
  renderCS();
}

function editBq(i){
  const b = bouquets[i];
  bqName.value = b.name;
  bqDesc.value = b.description||'';
  bqPrice.value = b.price||0;
  // ููุชุนุฏูู: ูููู ุจุญุฐู ุงููุฏููุฉ ุซู ุญูุธ ุงูุฌุฏูุฏุฉ ุนูุฏ ุงูุถุบุท ุญูุธ
  // ุฃู ูููู ุนูู ูุธุงู id ููุชุนุฏูู ูุงุญููุง โ ูุฐู ูุณุฎุฉ ูุจุณุทุฉ
  bouquets.splice(i,1);
  setState('bouquets', bouquets);
  populateAdmin();
}

function deleteBq(i){
  if(!confirm('ุญุฐู ุงูุจุงูุฉุ')) return;
  bouquets.splice(i,1); setState('bouquets', bouquets); populateAdmin();
}

// ุฅุฏุงุฑุฉ ุงูุชุบููู
function renderPacks(){
  packsContainer.innerHTML='';
  (settings.packs||[]).forEach((p,idx)=>{
    const div = document.createElement('div');
    div.className='form-row';
    div.innerHTML = `<label>${p.name}</label><input type="number" value="${p.price}" data-idx="${idx}" class="pack-input"> <button class="btn ghost small" onclick="removePack(${idx})">ุญุฐู</button>`;
    packsContainer.appendChild(div);
  });
  // ุฃุถู ูุณุชูุน ูุชุบููุฑ ุงูุฃุณุนุงุฑ
  Array.from(document.getElementsByClassName('pack-input')).forEach(inp=>{
    inp.addEventListener('input', e=>{
      const idx = e.target.getAttribute('data-idx');
      settings.packs[idx].price = Number(e.target.value) || 0;
    });
  });
}

addPack.addEventListener('click', ()=>{
  const name = newPackName.value.trim(); const price = Number(newPackPrice.value)||0;
  if(!name) return alert('ุงูุชุจ ุงุณู ุงูุชุบููู');
  settings.packs.push({name,price});
  newPackName.value=''; newPackPrice.value='';
  renderPacks();
});

// ุญูุธ ุงูุฅุนุฏุงุฏุงุช
saveSettings.addEventListener('click', ()=>{
  settings.flowerPrice = Number(flowerPriceIn.value) || 0;
  settings.colors = colorsInput.value.split(',').map(s=>s.trim()).filter(Boolean);
  setState('settings', settings);
  alert('ุชู ุญูุธ ุงูุฅุนุฏุงุฏุงุช');
  // ุชุญุฏูุซ ุงููุงุฌูุฉ ุงูุนุงูุฉ
  // (index.html) ุณููุฑุฃ ูู localStorage ุชููุงุฆูุงู ุนูุฏ ุงูุชุญููู ุงูุชุงูู
});

// ุทูุจุงุช ูุฅุฏุงุฑุชูุง
function renderOrders(filter='all'){
  orders = getState('orders', []);
  ordersList.innerHTML='';
  const filtered = orders.filter(o=> filter==='all' ? true : o.status===filter );
  if(!filtered.length){ ordersList.innerHTML = '<div class="small">ูุง ุชูุฌุฏ ุทูุจุงุช</div>'; return; }
  filtered.forEach((o,i)=>{
    const idx = orders.indexOf(o); // index in main orders array
    const div = document.createElement('div');
    div.className='order-item';
    div.innerHTML = `
      <div style="flex:1">
        <div style="display:flex;justify-content:space-between;align-items:center">
          <strong>ุทูุจ #${idx+1} โ ${o.pkgName}</strong>
          <span class="tag ${o.status}">${o.status==='new'?'ุฌุฏูุฏุฉ':o.status==='ready'?'ุฌุงูุฒุฉ':'ููุชููุฉ'}</span>
        </div>
        <div class="order-meta">
          ${o.qty} ูุฑุฏุฉ โ ููู: ${o.color} โ ุชุบููู: ${o.pack} โ ุงูุณุนุฑ: ${o.price} ุฏ.ุน
          <div>ุงูุงุณู: ${o.name} โ ุงููุงุชู: ${o.phone}</div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;gap:6px">
        ${ o.status === 'new' ? `<button class="btn small" onclick="markReady(${idx})">ุชู ุชุฌููุฒ ุงูุทูุจ</button>` : '' }
        ${ o.status === 'ready' ? `<button class="btn small" onclick="markCompleted(${idx})">ุชู ุงูุชุณููู</button>` : '' }
        <button class="btn ghost small" onclick="deleteOrder(${idx})">ุญุฐู</button>
      </div>
    `;
    ordersList.appendChild(div);
  });
}

function markReady(i){
  orders[i].status = 'ready'; setState('orders', orders); renderOrders(currentFilter);
}
function markCompleted(i){
  orders[i].status = 'completed'; setState('orders', orders); renderOrders(currentFilter);
}
function deleteOrder(i){
  if(!confirm('ุญุฐู ุงูุทูุจุ')) return;
  orders.splice(i,1); setState('orders', orders); renderOrders(currentFilter);
}

let currentFilter = 'all';
function filterOrders(f){ currentFilter = f; renderOrders(f); }

// ุฎุฏูุฉ ุงูุนููุงุก
function renderCS(){
  cs = getState('cs', []);
  csList.innerHTML='';
  if(!cs.length) { csList.innerHTML = '<div class="small">ูุง ุฑุณุงุฆู</div>'; return; }
  cs.forEach((m, i)=>{
    const d = document.createElement('div');
    d.className='cs-item';
    d.innerHTML = `<div><strong>${m.name}</strong> <span class="small">(${new Date(m.time).toLocaleString()})</span></div><div>${m.msg}</div><div style="text-align:left;margin-top:6px"><button class="btn ghost small" onclick="deleteCS(${i})">ุญุฐู</button></div>`;
    csList.appendChild(d);
  });
}
function deleteCS(i){ cs.splice(i,1); setState('cs', cs); renderCS(); }

// init
lockToAdmin();
// make sure stored settings are present
setState('settings', settings);
setState('bouquets', bouquets);
setState('orders', orders);
setState('cs', cs);
</script>
</body>
</html>



<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</title>
<link rel="stylesheet" href="styles.css">
<style>
body{font-family:tahoma, sans-serif; margin:0; background:#f8f8f8;}
.header-title{background:#4CAF50;color:white;padding:12px;text-align:center;font-size:1.2em;}
.container{padding:12px;}
.admin-columns{display:grid; grid-template-columns:repeat(auto-fit,minmax(300px,1fr)); gap:12px;}
.card{background:white;padding:12px;border-radius:8px;box-shadow:0 1px 5px rgba(0,0,0,0.1);}
.form-row{margin-bottom:8px; display:flex; flex-direction:column;}
.btn{padding:6px 12px; background:#4CAF50;color:white;border:none;border-radius:6px;cursor:pointer;}
.btn.small{padding:2px 6px; font-size:0.8em;}
.orders-list,.cs-list{max-height:300px;overflow:auto;}
.footer{margin-top:12px;text-align:center;color:#555;font-size:0.9em;}
</style>
</head>
<body>

<header>
  <div class="header-title">ğŸ› ï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ø£Ø¯Ù…Ù†</div>
</header>

<div class="container">

  <div class="admin-columns">

    <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¨Ø§Ù‚Ø§Øª -->
    <div>
      <h2>Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø©</h2>
      <div class="card">
        <div class="form-row"><label>Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ù‚Ø©</label><input type="text" id="bqName"></div>
        <div class="form-row"><label>Ø§Ù„ÙˆØµÙ</label><textarea id="bqDesc"></textarea></div>
        <div class="form-row"><label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ</label><input type="number" id="bqPrice"></div>
        <div class="form-row"><label>ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ù‚Ø©</label><input type="file" id="bqImage"></div>
        <button type="button" class="btn" id="addBouquet">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø©</button>
      </div>
    </div>

    <!-- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„ÙˆØ±ÙˆØ¯ ÙˆØ§Ù„ØªØºÙ„ÙŠÙ -->
    <div>
      <h2>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£Ø³Ø¹Ø§Ø± ÙˆØ§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ§Ù„ØªØºÙ„ÙŠÙ</h2>
      <div class="card">
        <div class="form-row"><label>Ø³Ø¹Ø± Ø§Ù„ÙˆØ±Ø¯Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø©</label><input type="number" id="flowerPriceIn"></div>
        <div class="form-row"><label>Ø£Ù„ÙˆØ§Ù† Ø§Ù„ÙˆØ±ÙˆØ¯ (Ø§ÙØµÙ„ Ø¨ÙØ§ØµÙ„Ø©)</label><input type="text" id="colorsInput"></div>
        <div class="form-row"><label>Ø¥Ø¶Ø§ÙØ© Ù†ÙˆØ¹ ØªØºÙ„ÙŠÙ</label><input type="text" id="newPackName" placeholder="Ø§Ø³Ù… Ø§Ù„ØªØºÙ„ÙŠÙ"><input type="number" id="newPackPrice" placeholder="Ø§Ù„Ø³Ø¹Ø±"></div>
        <button type="button" class="btn" id="addPackBtn">Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØºÙ„ÙŠÙ</button>
        <div id="packList" style="margin-top:10px"></div>
        <button type="button" class="btn" id="saveSettings" style="margin-top:10px">Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</button>
      </div>
    </div>

    <!-- Ø§Ù„Ø·Ù„Ø¨Ø§Øª -->
    <div>
      <h2>Ø§Ù„Ø·Ù„Ø¨Ø§Øª</h2>
      <div class="flex" style="gap:6px;margin-bottom:6px">
        <button type="button" class="btn small" onclick="filterOrders('all')">Ø§Ù„ÙƒÙ„</button>
        <button type="button" class="btn small" onclick="filterOrders('new')">Ø¬Ø¯ÙŠØ¯Ø©</button>
        <button type="button" class="btn small" onclick="filterOrders('ready')">Ø¬Ø§Ù‡Ø²Ø©</button>
      </div>
      <div id="ordersList" class="orders-list"></div>
    </div>

    <!-- Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ -->
    <div>
      <h2>Ø±Ø³Ø§Ø¦Ù„ Ø®Ø¯Ù…Ø© Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡</h2>
      <div id="csList" class="cs-list"></div>
    </div>

  </div>

  <div class="footer">Â© 2025 Ù…ØªØ¬Ø± Ø§Ù„ÙˆØ±Ø¯ â€” Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-storage-compat.js"></script>

<script>
const firebaseConfig = {
  apiKey: "AIzaSyDQ4hS5Sjvb312iFr0W8GA_nZOyoEaL1oA",
  authDomain: "flowershop-d8a1f.firebaseapp.com",
  projectId: "flowershop-d8a1f",
  storageBucket: "flowershop-d8a1f.firebasestorage.app",
  messagingSenderId: "68793859116",
  appId: "1:68793859116:web:71145547559f893ba8a589",
  measurementId: "G-RVL22TNM21"
};

const app = firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();
const storage = firebase.storage();

let bouquets=[], orders=[], cs=[], settings={flowerPrice:50,packs:[],colors:[]};

// Ø¬Ù„Ø¨ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
db.collection('settings').doc('main').get().then(doc=>{
  if(doc.exists){settings=doc.data(); renderPacks();}
});

// Ø¬Ù„Ø¨ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
db.collection('orders').orderBy('created','desc').onSnapshot(snapshot=>{
  orders=[];
  snapshot.forEach(doc=>orders.push({...doc.data(),id:doc.id}));
  renderOrders();
});

// Ø¬Ù„Ø¨ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
db.collection('cs').orderBy('time','desc').onSnapshot(snapshot=>{
  cs=[];
  snapshot.forEach(doc=>cs.push({...doc.data(),id:doc.id}));
  renderCS();
});

// Ø¥Ø¶Ø§ÙØ© Ø¨Ø§Ù‚Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ Ø±ÙØ¹ Ø§Ù„ØµÙˆØ±Ø©
document.getElementById('addBouquet').addEventListener('click', async ()=>{
  const name=document.getElementById('bqName').value.trim();
  const desc=document.getElementById('bqDesc').value.trim();
  const price=Number(document.getElementById('bqPrice').value)||0;
  const file=document.getElementById('bqImage').files[0];
  if(!name) return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¨Ø§Ù‚Ø©');

  let imageUrl='';
  if(file){
    const ref=storage.ref('bouquets/'+Date.now()+'_'+file.name);
    const snap=await ref.put(file);
    imageUrl=await snap.ref.getDownloadURL();
  }

  db.collection('bouquets').add({name,description:desc,price,image:imageUrl})
    .then(()=>{alert('ØªÙ…Øª Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¨Ø§Ù‚Ø©');})
    .catch(e=>alert('Ø®Ø·Ø£: '+e.message));
});

// Ø¥Ø¶Ø§ÙØ© Ù†ÙˆØ¹ ØªØºÙ„ÙŠÙ
document.getElementById('addPackBtn').addEventListener('click',()=>{
  const n=document.getElementById('newPackName').value.trim();
  const p=Number(document.getElementById('newPackPrice').value)||0;
  if(!n) return alert('Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„ØªØºÙ„ÙŠÙ');
  settings.packs.push({name:n,price:p});
  renderPacks();
  document.getElementById('newPackName').value=''; document.getElementById('newPackPrice').value='';
});

// Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
document.getElementById('saveSettings').addEventListener('click',()=>{
  settings.flowerPrice=Number(document.getElementById('flowerPriceIn').value)||0;
  settings.colors=document.getElementById('colorsInput').value.split(',').map(c=>c.trim()).filter(c=>c);
  db.collection('settings').doc('main').set(settings).then(()=>alert('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª'));
});

// Ø¹Ø±Ø¶ Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„ØªØºÙ„ÙŠÙ
function renderPacks(){
  const div=document.getElementById('packList');
  div.innerHTML='';
  settings.packs.forEach((p,i)=>{
    const d=document.createElement('div');
    d.className='small';
    d.innerHTML=`${p.name} (+${p.price} Ø¯.Ø¹) <button type="button" class="btn small" onclick="removePack(${i})">Ø­Ø°Ù</button>`;
    div.appendChild(d);
  });
}

function removePack(i){
  settings.packs.splice(i,1);
  renderPacks();
}

// Ø¹Ø±Ø¶ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
function renderOrders(filter='all'){
  const el=document.getElementById('ordersList');
  el.innerHTML='';
  let filtered=orders;
  if(filter!=='all') filtered=orders.filter(o=>o.status===filter);
  if(!filtered.length){el.innerHTML='<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª</div>'; return;}
  filtered.forEach((o,i)=>{
    const d=document.createElement('div'); d.className='card';
    d.innerHTML=`<strong>${o.name} (${o.phone})</strong>
    <div class="small">Ø¨Ø§Ù‚Ø©: ${o.pkgName}, Ø¹Ø¯Ø¯: ${o.qty}, Ù„ÙˆÙ†: ${o.color}, ØªØºÙ„ÙŠÙ: ${o.pack}</div>
    <div class="small">Ø§Ù„Ø³Ø¹Ø±: ${o.price} Ø¯.Ø¹</div>
    <button type="button" class="btn small" onclick="markReady('${o.id}')">ØªÙ… ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ø·Ù„Ø¨ âœ…</button>`;
    el.appendChild(d);
  });
}

function filterOrders(f){renderOrders(f);}
function markReady(id){db.collection('orders').doc(id).update({status:'ready'});}

// Ø¹Ø±Ø¶ Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡
function renderCS(){
  const el=document.getElementById('csList');
  el.innerHTML='';
  if(!cs.length){el.innerHTML='<div class="small">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø±Ø³Ø§Ø¦Ù„</div>'; return;}
  cs.forEach(c=>{
    const d=document.createElement('div'); d.className='card';
    d.innerHTML=`<strong>${c.name}</strong><div class="small">${c.msg}</div><div class="small">${new Date(c.time).toLocaleString()}</div>`;
    el.appendChild(d);
  });
}
</script>
</body>
</html>

